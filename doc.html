<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./styles/doc-styles.css">
    <title>My Document</title>
</head>

<body>
    <main>
        <h1>Audio Visualizer Documentation</h1>

        <section>
            <h2>Audio Effects</h2>
            <p>Just 2 simple nodes for bass or treble boost</p>
            <div id="duo-code-snipet">
                <pre>
                <code>
                    <span class="variable">bassNode</span> = <span class="variable">audioCtx</span>.<span class="function">createBiquadFilter</span>();
                    <span class="variable">bassNode.type</span> = <span class="string">"lowshelf"</span>;
                    <span class="variable">bassNode.frequency.value</span> = <span class="number">300</span>;
                    <span class="variable">bassNode.gain.value</span> = <span class="number">0</span>;
                </code>
            </pre>
                <pre>
                <code>
                    <span class="variable">trebleNode</span> = <span class="variable">audioCtx</span>.<span class="function">createBiquadFilter</span>();
                    <span class="variable">trebleNode.type</span> = <span class="string">'highshelf'</span>;
                    <span class="variable">trebleNode.frequency.value</span> = <span class="number">3000</span>;
                    <span class="variable">trebleNode.gain.value</span> = <span class="number">0</span>;
                </code>
            </pre>
            </div>
        </section>

        <section>
            <h2>The Fun Stuff</h2>
            <p>I have 2 sprites.. I read something about needing 2 right?</p>
            <div id="split">
                <div>
                    <span class="class"><h2>Particle</h2></span>
                    <p>Particles are the main foreground animation They are spawned using beat detection.</p>

                    <p>When a beat is detected, all bins in the audio frequency data is tested for an "audible" volume.
                        This spawns a particle at that location on a circle of radius 50</p>

                    <h3>Particles react to audio in the following ways:</h3>
                    <br>
                    <h3>Color is determined by spawn angle which is determined by frequency bin</h3>


                    <code>
                        <span class="blue">const</span> <span class="constant">hueRange</span> = <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">maxHue</span> - <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">minHue</span>;<br>
                        <span class="blue">const</span> <span class="constant">hue</span> = <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">minHue</span> + <span class="variable">(<span class="variable">angle</span> / <span class="class">Math</span>.<span class="variable">PI</span> * <span class="number">180</span>)</span> * (<span class="variable">hueRange</span> / <span class="number">360</span>);<br>
                        <span class="blue">this</span>.<span class="variable">color</span> = <span class="string">`hsl(<span class="blue">${</span><span class="constant">hue</span>}<span class="blue"></span>, 100%, 50%)`</span>;
                    </code>


                    <h3>Size is scaled based on volume at each bin</h3>


                    <code>
                        <span class="blue">let</span> <span class="variable">p</span> = <span class="blue">new</span> <span class="class">Particle</span>(<span class="variable">pos.x</span>, <span class="variable">pos.y</span>, <span class="variable">angle</span>, <span class="variable">i</span>, <span class="variable">Particle.particleControls.baseSpeed</span>, <span class="variable">audioData[i]</span> /
                        (<span class="constant">DEFAULTS</span>.<span class="variable">numSamples</span> - <span class="number">1</span>) * <span class="class">Particle</span>.<span class="variable">particleControls.baseRadius</span>);
                    </code>

                    <h3>Particles are then updated with their corresponding wafeForm data every frame</h4>

                        <code>
                        <code>
                            <span class="variable">let</span> <span class="variable">waveformIndex</span> = <span class="variable">Math</span>.<span class="function">floor</span>(<span class="variable">index</span> * (<span class="variable">audioDataWaveform</span>.<span class="variable">length</span> / <span class="variable">particles</span>.<span class="variable">length</span>));<br>
                            <span class="variable">let</span> <span class="variable">waveformValue</span> = <span class="variable">audioDataWaveform</span>[<span class="variable">waveformIndex</span>];<br>
                            <span class="variable">p</span>.<span class="function">update</span>(<span class="variable">waveformValue</span>);
                            </code>
                        </code>

                        <h3>Particles use this for velocity deviation</h3>

                        <code>
                        <span class="blue">let</span> <span class="variable">deviation</span> = (<span class="variable">waveformValue</span> - <span class="number">128</span>) / (<span class="number">32</span> / (<span class="variable">Particle.frequencyResponsivenessAdjusted</span> ?? <span class="number">1</span>));<br>
                        <span class="blue">this</span>.<span class="variable">x</span> += <span class="blue">this</span>.<span class="variable">vx</span> * (1 + <span class="variable">deviation</span>);<br>
                        <span class="blue">this</span>.<span class="variable">y</span> += <span class="blue">this</span>.<span class="variable">vy</span> * (1 + <span class="variable">deviation</span>);<br>

                        <span class="blue">this</span>.<span class="variable">angle</span> += <span class="blue">this</span>.<span class="variable">angularVelocity</span> * (1 + <span class="variable">Math</span>.<span class="function">abs</span>(<span class="variable">deviation</span>));<br>
                        <span class="blue">this</span>.<span class="variable">vx</span> = <span class="variable">Math</span>.<span class="function">cos</span>(<span class="blue">this</span>.<span class="variable">angle</span>) * <span class="blue">this</span>.<span class="variable">speed</span> * <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">speedMultiplier</span>;<br>
                        <span class="blue">this</span>.<span class="variable">vy</span> = <span class="variable">Math</span>.<span class="function">sin</span>(<span class="blue">this</span>.<span class="variable">angle</span>) * <span class="blue">this</span>.<span class="variable">speed</span> * <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">speedMultiplier</span>;
                    </code>

                        <h4>Alpha and Size are also effected by this deviation</h4>

                        <code>
                        <span class="blue">this</span>.radius += <span class="variable">this</span>.radiusGrowthPerFrame * (<span class="number">1</span> + <span class="class">Math</span>.<span class="function">abs</span>(<span class="variable">deviation</span>));<br>
                        <span class="blue">this</span>.alpha -= <span class="variable">this</span>.alphaFadePerFrame * (<span class="number">1</span> + <span class="class">Math</span>.<span class="function">abs</span>(<span class="variable">deviation</span>));
                    </code>
                </div>


                <div>
                    <span class="class"><h2>Star</h2></span>
                    <p>Stars are the circles in the background..</p>

                    <p>Stars are created at the start of the application and are kept near the canvas</p>

                    <h3>Stars react to audio inthe following ways:</h3>

                    <h4>When 'very loud' beats are detected (average volume of the frame) the stars change to random colors</h4>

                    <code>
                    <span class="keyword">if</span> (!<span class="variable">canvas</span>.<span class="function">getBeatDetected</span>() && <span class="variable">audioData[i]</span> > <span class="class">Particle</span>.<span class="variable">particleControls</span>.<span class="variable">veryLoudBeat</span>)<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">star</span>.<span class="function">changeStarsDirection();</span>
                    </code>

                    <h4>When a loud beat is detected (twice the normal audible threshold) The stars change direction randomly</h4>
                    
                    


                    <code>
                        <span class="keyword">else if</span>  (<span class="variable">average</span> > <span class="variable">particleBeatTracking.audibleThreshold</span> * <span class="number">2</span>) <br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span class="variable">star</span>.<span class="function">changeStarsDirection</span>();

                    </code>

                    <h4>Otherwise the stars move around slowly</h4>

                </div>
            </div>

        </section>

        <section>

            <h2>Other effects</h2>

            <p>There is a Vignette effect that pulses with loud beats. The detection for these is the same as the star direction change</p>

            <p>
                There is also a moving radial gradient effect in the background. The speed at which the colors change increases with the average volume of the music.
            </p>
            
            <p>
                All previous modules have been left in and can be toggled on (bars/circles from pe07). I added a line module similar to the bars as well.
            </p>

            <h3>Bass Drop</h3>

        </section>
    </main>

</body>

</html>